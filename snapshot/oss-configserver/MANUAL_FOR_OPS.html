<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2017-04-29 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170429" />
    <meta http-equiv="Content-Language" content="en" />
    <title>oss-configserver &#x2013; oss-configserver 运维手册</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarEnabled">
          
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">DOCUMENTATION <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="README.html"  title="README">README</a>
</li>
                  
                      <li>      <a href="MANUAL_FOR_USER.html"  title="用户手册">用户手册</a>
</li>
                  
                      <li>      <a href="MANUAL_FOR_ADMIN.html"  title="管理手册">管理手册</a>
</li>
                  
                      <li>      <a href="MANUAL_FOR_OPS.html"  title="运维手册">运维手册</a>
</li>
                  
                      <li>      <a href="CONTRIBUTION.html"  title="开发">开发</a>
</li>
                  
                      <li>      <a href="PERFORMANCE.html"  title="压力测试">压力测试</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="integration.html"  title="CI Management">CI Management</a>
</li>
                                  <li>      <a href="dependencies.html"  title="Dependencies">Dependencies</a>
</li>
                                  <li>      <a href="index.html"  title="About">About</a>
</li>
                                  <li>      <a href="project-summary.html"  title="Summary">Summary</a>
</li>
                                  <li>      <a href="issue-tracking.html"  title="Issue Management">Issue Management</a>
</li>
                                  <li>      <a href="team-list.html"  title="Team">Team</a>
</li>
                                  <li>      <a href="source-repository.html"  title="Source Code Management">Source Code Management</a>
</li>
                                  <li>      <a href="license.html"  title="Licenses">Licenses</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="jacoco/index.html"  title="JaCoCo">JaCoCo</a>
</li>
                                  <li>      <a href="surefire-report.html"  title="Surefire Report">Surefire Report</a>
</li>
                                  <li>      <a href="findbugs.html"  title="FindBugs">FindBugs</a>
</li>
                                  <li>      <a href="jdepend-report.html"  title="JDepend">JDepend</a>
</li>
                                  <li>      <a href="checkstyle.html"  title="Checkstyle">Checkstyle</a>
</li>
                                  <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="xref/index.html"  title="Source Xref">Source Xref</a>
</li>
                                  <li>      <a href="xref-test/index.html"  title="Test Source Xref">Test Source Xref</a>
</li>
                                  <li>      <a href="taglist.html"  title="Tag List">Tag List</a>
</li>
                                  <li>      <a href="pmd.html"  title="PMD">PMD</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>oss-configserver</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="publishDate">Last Published: 2017-04-29
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.0.6.OSS
                      </li>
                      
              
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">DOCUMENTATION</li>
                              
      <li>
  
                          <a href="README.html" title="README">
          <span class="none"></span>
        README</a>
            </li>
                
      <li>
  
                          <a href="MANUAL_FOR_USER.html" title="用户手册">
          <span class="none"></span>
        用户手册</a>
            </li>
                
      <li>
  
                          <a href="MANUAL_FOR_ADMIN.html" title="管理手册">
          <span class="none"></span>
        管理手册</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>运维手册</a>
          </li>
                
      <li>
  
                          <a href="CONTRIBUTION.html" title="开发">
          <span class="none"></span>
        开发</a>
            </li>
                
      <li>
  
                          <a href="PERFORMANCE.html" title="压力测试">
          <span class="none"></span>
        压力测试</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                              
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                    
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>oss-configserver &#x8fd0;&#x7ef4;&#x624b;&#x518c;</h1>

<div class="section">
<h2><a name="a"></a><a href="#a">&#x642d;&#x5efa;&#x751f;&#x4ea7;&#x73af;&#x5883;</a></h2>

<p>&#x4f9d;&#x8d56;&#x670d;&#x52a1;:</p>

<ul>
  
<li>
  
<p>
  
<p>git&#x670d;&#x52a1;</p>
  
<blockquote>
    
<ul>
      
<li>&#x672c;&#x6587;&#x4ee5;gitlab&#x4e3a;&#x4f8b;</li>
      
<li>configserver&#x7ba1;&#x7406;&#x7684;&#x914d;&#x7f6e;repository&#x9700;&#x5efa;&#x5728;&#x540c;&#x4e00;&#x4e2a;GROUP&#x6216;&#x7528;&#x6237;&#x8d26;&#x6237;&#x4e0b;</li>
      
<li>&#x9ed8;&#x8ba4;&#x4e3a;<tt>configserver</tt></li>
      
<li>&#x5c06;git&#x670d;&#x52a1;&#x4e3b;&#x673a;&#x5199;&#x5230;configserver&#x7684;&#x542f;&#x52a8;&#x53c2;&#x6570;/&#x73af;&#x5883;&#x53d8;&#x91cf;&#x4e2d;, <a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
    </ul>
  </blockquote></li>
  
<li>
  
<p>oss-eureka:latest</p>
  
<blockquote>
    
<ul>
      
<li>&#x4f7f;&#x7528;oss-eureka/docker-compose-production-peer.yml</li>
      
<li>&#x5c06;eureka&#x96c6;&#x7fa4;&#x4fe1;&#x606f;&#x5199;&#x5230;configserver&#x7684;&#x542f;&#x52a8;&#x53c2;&#x6570;/&#x73af;&#x5883;&#x53d8;&#x91cf;&#x4e2d;, <a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
    </ul>
  </blockquote></li>
  
<li>
  
<p>mysql:5.6.31</p>
  
<blockquote>
    
<ul>
      
<li>&#x4f7f;&#x7528;oss-configserver/docker-compose-mysql.yml</li>
      
<li>&#x4e3a;&#x751f;&#x4ea7;&#x73af;&#x5883;&#x751f;&#x6210;&#x7528;&#x6237;&#x540d;/&#x5bc6;&#x7801;</li>
      
<li>&#x5c06;&#x7528;&#x6237;&#x540d;/&#x5bc6;&#x7801;&#x5199;&#x5230;configserver&#x7684;&#x542f;&#x52a8;&#x53c2;&#x6570;/&#x73af;&#x5883;&#x53d8;&#x91cf;&#x4e2d;, <a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
    </ul>
  </blockquote></li>
  
<li>
  
<p>rabbitmq:3.6.5</p>
  
<blockquote>
    
<ul>
      
<li>&#x4f7f;&#x7528;oss-cloudbus/docker-compose.yml</li>
      
<li>&#x4e3a;&#x751f;&#x4ea7;&#x73af;&#x5883;&#x751f;&#x6210;&#x7528;&#x6237;&#x540d;/&#x5bc6;&#x7801;</li>
      
<li>&#x5c06;&#x7528;&#x6237;&#x540d;/&#x5bc6;&#x7801;&#x5199;&#x5230;&#x901a;&#x7528;&#x914d;&#x7f6e;&#x4e2d;</li>
      
<li>&#x5c06;&#x7528;&#x6237;&#x540d;/&#x5bc6;&#x7801;&#x5199;&#x5230;configserver&#x7684;&#x542f;&#x52a8;&#x53c2;&#x6570;/&#x73af;&#x5883;&#x53d8;&#x91cf;&#x4e2d;, <a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
    </ul>
  </blockquote></li>
</ul>

<p>&#x914d;&#x7f6e;checklist:</p>

<ul>
  
<li>
  
<p>
  
<p>&#x786e;&#x5b9a;git&#x670d;&#x52a1;&#x5730;&#x5740;</p>
  
<blockquote>
    
<ul>
      
<li>&#x9700;&#x4fdd;&#x8bc1;configserver&#x53ef;&#x4ee5;&#x8bbf;&#x95ee;git&#x670d;&#x52a1;, &#x5305;&#x62ec;http(s)&#x548c;ssh&#x7aef;&#x53e3;</li>
      
<li>&#x9700;&#x4fdd;&#x8bc1;git&#x670d;&#x52a1;&#x53ef;&#x4ee5;&#x8bbf;&#x95ee;configserver&#x7684;http(s)&#x7aef;&#x53e3;, &#x9ed8;&#x8ba4;&#x4e3a;8888, &#x7a0d;&#x540e;&#x9700;&#x8981;&#x5728;configserver&#x4e0a;&#x914d;&#x7f6e;&#x767d;&#x540d;&#x5355;.</li>
    </ul>
  </blockquote></li>
  
<li>
  
<p>&#x4e3a;&#x751f;&#x6210;&#x73af;&#x5883;&#x7684;&#x901a;&#x7528;&#x914d;&#x7f6e;&#x521b;&#x5efa;git repository</p>
  
<blockquote>
    
<ul>
      
<li>&#x751f;&#x4ea7;&#x73af;&#x5883;&#x7684;&#x901a;&#x7528;&#x914d;&#x7f6e;repository&#x540d;&#x79f0;&#x9ed8;&#x8ba4;&#x4e3a;<tt>common-production-config</tt></li>
      
<li>&#x751f;&#x4ea7;&#x73af;&#x5883;&#x7684;&#x901a;&#x7528;&#x914d;&#x7f6e;repository&#x5206;&#x652f;&#x9ed8;&#x8ba4;&#x4e3a;<tt>production.env</tt></li>
    </ul>
  </blockquote></li>
  
<li>
  
<p>git&#x670d;&#x52a1;&#x4e0a;&#x6bcf;&#x4e2a;&#x914d;&#x7f6e;repository&#x4e2d;&#x914d;&#x7f6e;webhook</p>
  
<blockquote>
    
<ul>
      
<li>&#x4ee5;gitlab&#x4e3a;&#x4f8b;</li>
      
<li>&#x53ea;&#x542f;&#x7528;Push events, &#x4e0d;&#x5f00;&#x542f;SSL verification</li>
      
<li>&#x5730;&#x5740;&#x4e3a;http://${configserver-host}:8888/monitor</li>
      
<li>&#x4e0d;&#x4f7f;&#x7528;Secret Token, &#x901a;&#x8fc7;&#x5728;configserver&#x4e0a;&#x914d;&#x7f6e;&#x767d;&#x540d;&#x5355;&#x6765;&#x5141;&#x8bb8;git&#x670d;&#x52a1;&#x8bbf;&#x95ee;.</li>
    </ul>
  </blockquote></li>
  
<li>
  
<p>&#x4e3a;&#x751f;&#x4ea7;&#x73af;&#x5883;&#x751f;&#x6210;deploy key</p>
  
<blockquote>
    
<ul>
      
<li>&#x751f;&#x6210;&#x5bc6;&#x94a5;</li>
      
<li>&#x5c06;&#x516c;&#x94a5;&#x8bbe;&#x7f6e;&#x5230;git&#x670d;&#x52a1;&#x4e0a;&#x6bcf;&#x4e2a;&#x914d;&#x7f6e;repository&#x4e2d;</li>
      
<li>&#x5c06;&#x79c1;&#x94a5;&#x653e;&#x5728;configserver&#x7684;docker&#x5bb9;&#x5668;&#x53ef;&#x4ee5;mount&#x7684;&#x4f4d;&#x7f6e;</li>
    </ul>
  </blockquote></li>
  
<li>
  
<p>&#x8bbe;&#x7f6e;configserver&#x4f7f;&#x7528;&#x7684;deploy key, <a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></p></li>
  
<li>&#x8bbe;&#x7f6e;configserver&#x7684;monitor&#x767d;&#x540d;&#x5355;, <a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
  
<li>&#x8bbe;&#x7f6e;configserver&#x7684;eureka&#x5730;&#x5740;, <a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
  
<li>&#x8bbe;&#x7f6e;configserver&#x7684;mysql&#x7528;&#x6237;&#x540d;/&#x5bc6;&#x7801;, <a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
  
<li>&#x8bbe;&#x7f6e;configserver&#x7684;rabbitmq&#x7684;&#x7528;&#x6237;&#x540d;/&#x5bc6;&#x7801;, <a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
  
<li>&#x751f;&#x6210;configserver&#x7ba1;&#x7406;&#x5458;&#x7528;&#x6237;&#x540d;/&#x5bc6;&#x7801;, <a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
  
<li>
  
<p>&#x8bbe;&#x7f6e;configserver&#x4f7f;&#x7528;&#x7684;keystore</p>
  
<blockquote>
    
<ul>
      
<li><a href="#CREATE_KEYSTORE">&#x4e3a;&#x751f;&#x4ea7;&#x73af;&#x5883;&#x751f;&#x6210;keystore</a></li>
      
<li>&#x914d;&#x7f6e;<a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
    </ul>
  </blockquote></li>
  
<li>
  
<p>&#x8bbe;&#x7f6e;SPRING_CLOUD_CONFIG_SERVER_MONITOR_WHITELIST</p>
  
<blockquote>
    
<ul>
      
<li>&#x914d;&#x7f6e;<a href="#PRODUCTION_EXAMPLE">&#x89c1;&#x6837;&#x4f8b;</a></li>
    </ul>
  </blockquote></li>
  
<li>
  
<p><a href="./PERMISSIONS.html">&#x6743;&#x9650;&#x7ba1;&#x7406;</a></p></li>
</ul>
</div>
<div class="section">
<h2><a name="a_example"></a><a name="NON_PRODUCTION_EXAMPLE">&#x642d;&#x5efa;&#x6d4b;&#x8bd5;&#x73af;&#x5883; example</a></h2>

<div class="source">
<div class="source"><pre class="prettyprint linenums"># see: http://stackoverflow.com/questions/13322485/how-to-i-get-the-primary-ip-address-of-the-local-machine-on-linux-and-os-x

export GIT_HOST=gitlab.internal
export SPRING_CLOUD_CONFIG_SERVER_DEPLOYKEY=&quot;classpath:deploy_key&quot;
export SPRING_CLOUD_CONFIG_SERVER_MONITOR_WHITELIST=&quot;${GIT_HOST},$(dig +short ${GIT_HOST})&quot;

export EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=&quot;http://user:user_pass@oss-eureka-peer1.internal:8761/eureka/,http://user:user_pass@oss-eureka-peer2.internal:8761/eureka/,http://user:user_pass@oss-eureka-peer3.internal:8761/eureka/&quot;
export EUREKA_INSTANCE_HOSTNAME=&quot;oss-configserver.internal&quot;

export MYSQL_ROOT_PASSWORD=&quot;$(echo `&lt;/dev/urandom tr -dc A-Za-z0-9 | head -c16`)&quot;
# assume db on same host
export DB_ADDR=&quot;$(ip route get 1 | awk '{print $NF;exit}')&quot;
export DB_USER=&quot;user&quot;
export DB_PASS=&quot;user_pass&quot;

# assume rabbitmq on same host
export SPRING_RABBITMQ_HOST=&quot;$(ip route get 1 | awk '{print $NF;exit}')&quot;
export SPRING_RABBITMQ_USERNAME=&quot;user&quot;
export SPRING_RABBITMQ_PASSWORD=&quot;user_pass&quot;

export SECURITY_USER_PASSWORD=&quot;admin_pass&quot;

export ENCRYPT_KEYSTORE_LOCATION=&quot;classpath:keystore.jks&quot;
</pre></div></div>
</div>
<div class="section">
<h2><a name="a_example"></a><a name="PRODUCTION_EXAMPLE">&#x642d;&#x5efa;&#x751f;&#x4ea7;&#x73af;&#x5883; example</a></h2>

<div class="source">
<div class="source"><pre class="prettyprint linenums">export GIT_HOST=gitlab.internal
ssh-keygen -t rsa -b 2048 -f production-deploy_key -q -N &quot;&quot; -C &quot;production-configserver@home1.cn&quot;
export SPRING_CLOUD_CONFIG_SERVER_DEPLOYKEY=&quot;file:/root/production-deploy_key&quot;
echo &quot;SAVE_THIS deploy_key: $(pwd)/production-deploy_key&quot;
export SPRING_CLOUD_CONFIG_SERVER_MONITOR_WHITELIST=&quot;${GIT_HOST},$(dig +short ${GIT_HOST})&quot;

export EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=&quot;http://user:user_pass@oss-eureka-peer1.internal:8761/eureka/,http://user:user_pass@oss-eureka-peer2.internal:8761/eureka/,http://user:user_pass@oss-eureka-peer3.internal:8761/eureka/&quot;
export EUREKA_INSTANCE_HOSTNAME=&quot;oss-configserver.internal&quot;

export MYSQL_ROOT_PASSWORD=&quot;$(echo `&lt;/dev/urandom tr -dc A-Za-z0-9 | head -c16`)&quot;
# assume db on same host
export DB_ADDR=&quot;$(ip route get 1 | awk '{print $NF;exit}')&quot;
export DB_USER=&quot;configserver&quot;
export DB_PASS=&quot;$(echo `&lt;/dev/urandom tr -dc A-Za-z0-9 | head -c16`)&quot;
echo &quot;SAVE_THIS MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}&quot;
echo &quot;SAVE_THIS DB_PASS: ${DB_PASS}&quot;

# assume rabbitmq on same host
export SPRING_RABBITMQ_HOST=&quot;$(ip route get 1 | awk '{print $NF;exit}')&quot;
export SPRING_RABBITMQ_USERNAME=&quot;user&quot;
export SPRING_RABBITMQ_PASSWORD=&quot;$(echo `&lt;/dev/urandom tr -dc A-Za-z0-9 | head -c16`)&quot;
echo &quot;SAVE_THIS SPRING_RABBITMQ_PASSWORD: ${SPRING_RABBITMQ_PASSWORD}&quot;

export SECURITY_USER_PASSWORD=&quot;$(echo `&lt;/dev/urandom tr -dc A-Za-z0-9 | head -c8`)&quot;
echo &quot;SAVE_THIS SECURITY_USER_PASSWORD: ${SECURITY_USER_PASSWORD}&quot;
</pre></div></div>

<p>keyStore&#x914d;&#x7f6e;&#x89c1;: <a href="#CREATE_KEYSTORE">&#x4e3a;&#x751f;&#x4ea7;&#x73af;&#x5883;&#x751f;&#x6210;keystore</a></p>
</div>
<div class="section">
<h2><a name="Build-in_deploy_key_for_non-production_environments"></a>Build-in deploy key for non-production environments</h2>

<div class="source">
<div class="source"><pre class="prettyprint linenums">ssh-keygen -t rsa -b 2048 -f src/main/resources/deploy_key -q -N &quot;&quot; -C &quot;configserver@home1.cn&quot;
</pre></div></div>
</div>
<div class="section">
<h2><a name="Cipher_and_keystore"></a><a href="#cipher-and-keystore">Cipher and keystore</a></h2>

<ol style="list-style-type: decimal">
  
<li>
  
<p>
  
<p>&#x4f7f;&#x7528;&#x5bf9;&#x79f0;&#x52a0;&#x5bc6;</p>
  
<blockquote>
    
<ul>
      
<li>&#x4f18;&#x70b9;&#xff1a;&#x8bbe;&#x7f6e;&#x7b80;&#x5355;&#x5982;&#x4e0b;</li>
      
<li>encrypt.key: changeme # &#x5bf9;&#x79f0;&#x52a0;&#x5bc6;&#x79d8;&#x94a5;</li>
    </ul>
  </blockquote></li>
  
<li>
  
<p>&#x4f7f;&#x7528;&#x975e;&#x5bf9;&#x79f0;&#x52a0;&#x5bc6;&#xff0c;&#x5982;&#x4f7f;&#x7528;keyStore:</p></li>
</ol>

<p><b><i>&#x524d;&#x7f6e;&#x6761;&#x4ef6;</i></b>&#xff1a;&#x9700;&#x8981;&#x4ece;oracle&#x5b98;&#x7f51;&#x4e0b;&#x8f7d;(JCE)Unlimited Strength Jurisdiction Policy Files(&#x4e24;&#x4e2a;jar)&#x653e;&#x5165;jre&#x7684;lib/security</p>

<p>configserver&#x7684;bootstrap.yml&#x914d;&#x7f6e;:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">encrypt:                              # &#x914d;&#x7f6e;&#x9879;&#x52a0;&#x5bc6;&#x914d;&#x7f6e;
  keyStore:
    alias: key_alias                  # keyPair&#x522b;&#x540d;
    location: classpath:/keystore.jks # keyStore&#x4f4d;&#x7f6e;
    password: store_pass              # keyStore&#x5bc6;&#x7801;
    secret: key_pass                  # keyPair&#x5bc6;&#x7801;
</pre></div></div>
</div>
<div class="section">
<h2><a name="Build-in_keystore_for_non-production_environments"></a>Build-in keystore for non-production environments</h2>

<div class="source">
<div class="source"><pre class="prettyprint linenums">KEYSTORE_KEY_C=&quot;CN&quot;
KEYSTORE_KEY_CN=&quot;home1&quot;
KEYSTORE_KEY_L=&quot;Beijing&quot;
KEYSTORE_KEY_O=&quot;home1&quot;
KEYSTORE_KEY_OU=&quot;home1&quot;
KEYSTORE_KEY_S=&quot;Beijing&quot;
ENCRYPT_KEYSTORE_ALIAS=&quot;key_alias&quot;
ENCRYPT_KEYSTORE_LOCATION=&quot;keystore.jks&quot;
ENCRYPT_KEYSTORE_PASSWORD=&quot;store_pass&quot;
ENCRYPT_KEYSTORE_SECRET=&quot;key_pass&quot;

keytool -genkeypair -alias ${ENCRYPT_KEYSTORE_ALIAS} -keyalg RSA -keysize 2048 -validity 3650 -dname &quot;CN=${KEYSTORE_KEY_CN},OU=${KEYSTORE_KEY_OU},O=${KEYSTORE_KEY_O},L=${KEYSTORE_KEY_L},S=${KEYSTORE_KEY_S},C=${KEYSTORE_KEY_C}&quot; -keypass ${ENCRYPT_KEYSTORE_SECRET} -storepass ${ENCRYPT_KEYSTORE_PASSWORD} -keystore ${ENCRYPT_KEYSTORE_LOCATION}

echo &quot;encrypt.keyStore.alias: ${ENCRYPT_KEYSTORE_ALIAS}&quot;
echo &quot;encrypt.keyStore.location: ${ENCRYPT_KEYSTORE_LOCATION}&quot;
echo &quot;encrypt.keyStore.password: ${ENCRYPT_KEYSTORE_PASSWORD}&quot;
echo &quot;encrypt.keyStore.secret: ${ENCRYPT_KEYSTORE_SECRET}&quot;
</pre></div></div>

<p>Can change alias and keypass then run again to generate multiple keypair.<br /> Use <tt>keytool -list -keystore keystore.jks</tt> to list keypairs.<br /> Note: Create separate keystore for production environment</p>
</div>
<div class="section">
<h2><a name="Create_keystore_for_production_environment"></a><a name="CREATE_KEYSTORE">Create keystore for production environment</a></h2>

<p>Random password is more secure.</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">KEYSTORE_KEY_C=&quot;CN&quot;
KEYSTORE_KEY_CN=&quot;home1&quot;
KEYSTORE_KEY_L=&quot;Beijing&quot;
KEYSTORE_KEY_O=&quot;home1&quot;
KEYSTORE_KEY_OU=&quot;home1&quot;
KEYSTORE_KEY_S=&quot;Beijing&quot;
ENCRYPT_KEYSTORE_ALIAS=&quot;production-key&quot;
ENCRYPT_KEYSTORE_LOCATION=&quot;production-keystore.jks&quot;
ENCRYPT_KEYSTORE_PASSWORD=&quot;$(openssl rand -base64 32)&quot;
ENCRYPT_KEYSTORE_SECRET=&quot;$(echo `&lt;/dev/urandom tr -dc A-Za-z0-9 | head -c16`)&quot;

keytool -genkeypair -alias ${ENCRYPT_KEYSTORE_ALIAS} -keyalg RSA -keysize 2048 -validity 3650 -dname &quot;CN=${KEYSTORE_KEY_CN},OU=${KEYSTORE_KEY_OU},O=${KEYSTORE_KEY_O},L=${KEYSTORE_KEY_L},S=${KEYSTORE_KEY_S},C=${KEYSTORE_KEY_C}&quot; -keypass ${ENCRYPT_KEYSTORE_SECRET} -storepass ${ENCRYPT_KEYSTORE_PASSWORD} -keystore ${ENCRYPT_KEYSTORE_LOCATION}

echo &quot;encrypt.keyStore.alias: ${ENCRYPT_KEYSTORE_ALIAS}&quot;
echo &quot;encrypt.keyStore.location: ${ENCRYPT_KEYSTORE_LOCATION}&quot;
echo &quot;encrypt.keyStore.password: ${ENCRYPT_KEYSTORE_PASSWORD}&quot;
echo &quot;encrypt.keyStore.secret: ${ENCRYPT_KEYSTORE_SECRET}&quot;

export ENCRYPT_KEYSTORE_ALIAS=${ENCRYPT_KEYSTORE_ALIAS}
export ENCRYPT_KEYSTORE_LOCATION=&quot;file:/root/${ENCRYPT_KEYSTORE_LOCATION}&quot;
export ENCRYPT_KEYSTORE_PASSWORD=${ENCRYPT_KEYSTORE_PASSWORD}
export ENCRYPT_KEYSTORE_SECRET=${ENCRYPT_KEYSTORE_SECRET}
</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2017.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
